<form id="message-form" class="form-horizontal h-100" action="/messaging/send/" method="POST">
{% csrf_token %}
    <div class="row d-flex flex-column h-100 py-3">
        <!-- Close messaging sidebar container -->
        <div class="col col-12">
            <div id="messaging-header" class="d-flex flex-row justify-content-left">
                <div class="col px-3">
                    <button class="btn collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#messaging-sidebar-content"
                            aria-expanded="false" aria-controls="messaging-sidebar-content">
                        <i class="fas fa-xmark"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Messaging sidebar title/buttons container -->
        <div class="col col-12 compose collapse show">
            <div id="messaging-title" class="d-flex flex-row justify-content-left pt-3">
                <div class="col col-auto h3 px-4">
                    <i class="fa-solid fa-envelopes-bulk fa-lg mx-3"></i>
                    Your Inbox
                </div>
            </div>
            <div id="inbox-button-row" class="d-flex flex-row py-4">
                <div id="inbox-btn-container-left" class="col px-3">
                    <button class="btn btn-outline-secondary" type="button">
                        Select all
                    </button>
                    <button class="btn btn-outline-secondary d-none" type="button">
                        Mark as unread
                    </button>
                </div>
                <div id="inbox-btn-container-right" class="col col-auto px-3">
                    <button class="btn btn-secondary" type="button" data-bs-toggle="collapse" data-bs-target=".compose">
                        Send message...
                    </button>
                </div>
            </div>
        </div>
        <!-- Compose message collapse container -->
        <div id="compose-header" class="col col-12 compose collapse overflow-auto py-2" style="padding-left: 2rem; padding-right: 2rem;">
            <div class="d-flex flex-row">
                <div class="col col-auto px-2" style="font-weight: 300;">
                    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target=".compose">
                        Return to Inbox
                    </button>
                </div>
            </div>
            <div class="d-flex flex-row justify-content-center pt-4">
                <div class="col col-auto h4">
                    Compose Message
                </div>
            </div>
            <div class="d-flex flex-row pt-3">
                <div class="col col-auto px-1">
                    <label for="compose-input-user" class="control-label" style="font-weight: 300;">To:</label>
                </div>
                <div class="col" style="padding-right: 0.25rem;">
                    {{ message_form.receiver }}
                </div>
            </div>
        </div>
        <!-- Standard conversation collapse container -->
        <div id="view-thread-container" class="col col-12 compose collapse collapse-horizontal overflow-auto p-2" style="flex: 1;">
        </div>
        <!-- Messaging sidebar inbox container -->
        <div id="inbox" class="col col-12 compose collapse collapse-horizontal show" style="flex: 1; overflow-y: auto; overflow-x: hidden;">
            {% for thread in inbox %}
                <div class="inbox-row d-flex flex-row flex-wrap">
                    <div class="col-12 d-flex flex-column">
                        <ul class="list-group">
                            <li class="list-group-item border-left-0{% if thread.unread %} unread{% endif %} no-gutters py-2"
                                    data-toggle="tooltip" data-placement="left" title="{{ thread.unread|yesno:"Unread message,Message" }} from {{ thread.name }}">
                                <div class="row">
                                    <div class="col col-1 d-flex flex-column p-0">
                                        <input id="thread_select{{ thread.nameID }}" class="form-check-input m-auto" type="checkbox" value=""
                                            data-toggle="tooltip" data-placement="left" title="Select this thread.">
                                    </div>
                                    <div class="col col-11 p-0">
                                        <div class="d-flex flex-row">
                                            <div class="col" style="padding-left: 1rem;">
                                                <div class="mt-2" style="font-weight: 300;">
                                                    {{ thread.last_received }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-row">
                                            <div class="col" style="padding-left: 1rem;">
                                                <div class="my-1">
                                                    {{ thread.name }}
                                                </div>
                                            </div>
                                            <div class="col col-auto">
                                                <div class="my-1" style="padding-right: 1.5rem; font-weight: 300;">

                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-row justify-content-left">
                                            <div class="col col-auto mb-2" style="padding-left: 1rem; font-weight: 300;">
                                                {{ thread.message_snippet }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            {% empty %}
                <div class="row text-center pt-5">
                    <div class="col" style="font-weight: 300;">
                        Send a message to start a thread...
                    </div>
                </div>
            {% endfor %}
        </div>
        <!-- Messaging sidebar footer container -->
        <div id="messaging-footer" class="col col-12 compose collapse mt-2 mb-1">
            <div class="input-group w-auto px-3">
                {% comment %} <input type="text" class="form-control" placeholder="Send message&hellip;"
                    aria-label="Compose message input" aria-described-by="send-message-btn"> {% endcomment %}
                {{ message_form.body }}
                <button id="send-message-btn" type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        <!-- Messaging sidebar compose footer -->
        <div id="compose-footer" class="col col-12 compose collapse show mt-2 mb-1">
            <div class="row text-center">
                <div class="col">
                    You have {{ unread_messages }} unread message{{ unread_messages|pluralize }}.
                </div>
            </div>
        </div>
    {% empty %}
        <div class="row text-center pt-5">
            <div class="col" style="font-weight: 300;">
                Send a message to start a thread...
            </div>
        </div>
    {% endfor %}
    <div id="messaging-button-row" class="d-flex flex-row">

    </div>
</form>

<script>
    document.getElementsByClassName("inbox-row").addEventListener("click", function (e) {

    });
    // Handle asynchronous form submit
    document.getElementById("message-form").addEventListener("submit", function (e) {
        e.preventDefault();

        let xhr = new XMLHttpRequest();

        xhr.open('POST', '/messaging/send/', true);
        xhr.setRequestHeader("Content-type", "application/json; charset=UTF-8");
        xhr.send(JSON.stringify("Testing agh"));

        xhr.onload = function () {
            if(xhr.status === 201) {
                console.log("Post successfully created");
            }
        }
    });
</script>
